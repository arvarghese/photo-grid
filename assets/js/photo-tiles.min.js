/*
 * photo-tiles (https://github.com/arvarghese/photo-tiles)
 * Copyright 2016-2017 arun varghese
 */
var PhotoTiles={config:{initialized:!1,demoMode:!1,container:".photo-tiles-container",shouldPlay:!0,transition:2e3,timerId:0,photoListIndex:0,photoList:[]},initialize:function(e){return PhotoTiles.config.initialized?void console.info("PhotoTiles already initialized."):e?(PhotoTiles.config.container=e.selector||".photo-tiles-container",PhotoTiles.config.shouldPlay=e.shouldPlay||!0,PhotoTiles.config.transition=e.transition||2e3,PhotoTiles.config.photoList=e.photoList||[],PhotoTiles.config.demoMode=e.demoMode||!1,PhotoTiles.validateConfigs(e)?(e.demoMode&&(PhotoTiles.config.photoList=["assets/images/demo/demo-image-1.jpeg","assets/images/demo/demo-image-2.jpeg","assets/images/demo/demo-image-3.jpeg","assets/images/demo/demo-image-4.jpeg","assets/images/demo/demo-image-5.jpeg","assets/images/demo/demo-image-6.jpeg","assets/images/demo/demo-image-7.jpeg","assets/images/demo/demo-image-8.jpeg","assets/images/demo/demo-image-9.jpeg","assets/images/demo/demo-image-10.jpeg"]),PhotoTiles.buildTiles(),PhotoTiles.loadTiles(),PhotoTiles.loadEvents(),void(PhotoTiles.config.initialized=!0)):void console.info("PhotoTiles not initialized.")):void console.info("No configuration object was passed, checkout https://github.com/arvarghese/photo-tiles#customization for an example.")},validateConfigs:function(e){return document.querySelector(PhotoTiles.config.container)?!(0===PhotoTiles.config.photoList.length&&!PhotoTiles.config.demoMode)||(console.info("No photos specified, please initialize PhotoTiles with the attribute 'photoList' set to a list of photos."),!1):(console.info("No container specified or container doesn't exist on the page with selector '"+PhotoTiles.config.container+"'."),!1)},buildTiles:function(){var e=document.querySelector(PhotoTiles.config.container),o=document.createElement("div");o.className="photo-tiles";var t=document.createElement("div");t.className="photo-tiles-row";var i=document.createElement("div");i.className="photo-tiles-row",o.appendChild(t),o.appendChild(i),e.appendChild(o)},loadTiles:function(){Array.prototype.forEach.call(document.querySelectorAll(".photo-tiles-row"),function(e){var o,t,i,l;o=document.createElement("div"),o.className="photo left photo-lg",o.style.transform="translateX(0px)",o.style["background-image"]="url("+PhotoTiles.getNextPhoto()+")",e.appendChild(o),o=document.createElement("div"),o.className="photo middle photo-sm",i=document.createElement("div"),i.className="photo-sm-dual",l=document.createElement("div"),l.className="photo-sm-dual",o.appendChild(i),o.appendChild(l),e.appendChild(o),t=PhotoTiles.tileInfo.getLgWidth(),o.style.transform="translateX("+t+"px)",Array.prototype.forEach.call(o.children,function(e){e.style["background-image"]="url("+PhotoTiles.getNextPhoto()+")"}),o=document.createElement("div"),o.className="photo right photo-lg",t=PhotoTiles.tileInfo.getLgWidth()+PhotoTiles.tileInfo.getSmWidth(),o.style.transform="translateX("+t+"px)",o.style["background-image"]="url("+PhotoTiles.getNextPhoto()+")",e.appendChild(o)}),setTimeout(function(){Array.prototype.forEach.call(document.querySelectorAll(".photo"),function(e){e.classList.add("loaded")})},1e3)},loadEvents:function(){PhotoTiles.config.shouldPlay&&PhotoTiles.loadTimer();var e;window.addEventListener("resize",function(){Array.prototype.forEach.call(document.querySelectorAll(".photo-tiles-row"),function(o){e=o.querySelector(".left")&&o.querySelector(".left").classList.contains("photo-sm")?PhotoTiles.tileInfo.getSmWidth():PhotoTiles.tileInfo.getLgWidth(),o.querySelector(".middle").style.transform="translateX("+e+"px)",e=o.querySelector(".right")&&o.querySelector(".right").classList.contains("photo-sm")?2*PhotoTiles.tileInfo.getLgWidth():PhotoTiles.tileInfo.getSmWidth()+PhotoTiles.tileInfo.getLgWidth(),o.querySelector(".right").style.transform="translateX("+e+"px)"})}),PhotoTiles.loadKeyboardEvents()},loadTimer:function(){PhotoTiles.config.timerId=setInterval(function(){PhotoTiles.shiftPhotos()},PhotoTiles.config.transition)},tagRandomPhotoForRemoval:function(){var e=document.querySelectorAll(".photo:not(.remove)");e.length<2&&clearInterval(PhotoTiles.config.timerId);var o=e[Math.floor(Math.random()*e.length)];o.classList.contains("left")?o.style.transform+="translateX(-100%)":o.classList.contains("right")&&(o.style.transform+="translateX(100%)"),o.classList.contains("middle")&&(0===Array.prototype.indexOf.call(o.parentElement.parentElement.children,o.parentElement)?o.style.transform+="translateY(-100%)":o.style.transform+="translateY(100%)"),o.classList.add("remove")},shiftPhotos:function(){var e=PhotoTiles.getNextPhoto(),o=new Image;o.onload=function(){PhotoTiles.tagRandomPhotoForRemoval(),setTimeout(function(){PhotoTiles.adjustTiles(),PhotoTiles.addPhoto(e)},300)},o.src=e},addPhoto:function(e){Array.prototype.forEach.call(document.querySelectorAll(".photo-tiles-row"),function(o){if(3!==o.querySelectorAll(".photo").length){var t,i;if(o.querySelector(".photo-sm"))t=document.createElement("div"),t.className="photo right photo-lg",i=PhotoTiles.tileInfo.getSmWidth()+PhotoTiles.tileInfo.getLgWidth();else{t=document.createElement("div"),t.className="photo right photo-sm";var l=document.createElement("div");l.className="photo-sm-dual";var s=document.createElement("div");s.className="photo-sm-dual",t.appendChild(l),t.appendChild(s),i=2*PhotoTiles.tileInfo.getLgWidth()}o.appendChild(t);var n=window.innerWidth;t.classList.contains("photo-sm")?(t.style.transform="translateX("+n+"px)",Array.prototype.forEach.call(o.querySelectorAll(".photo-sm-dual"),function(o){e=PhotoTiles.getNextPhoto(),o.style["background-image"]="url("+e+")"})):(t.style.transition="0s",t.style.transform="translateX("+n+"px)",t.style["background-image"]="url("+e+")"),setTimeout(function(){t.style.transition=".5s ease-in-out",t.style.transform="translateX("+i+"px)",t.classList.add("loaded")},200)}})},adjustTiles:function(){var e,o;Array.prototype.forEach.call(document.querySelectorAll(".remove"),function(e){e.parentNode.removeChild(e)}),Array.prototype.forEach.call(document.querySelectorAll(".photo-tiles-row"),function(t){t.querySelector(".left")||(t.querySelector(".middle")?(o=t.querySelector(".middle"),o.style.transform="translateX(0px)",o.classList.remove("middle"),o.classList.add("left"),t.querySelector(".right")&&(e=t.querySelector(".left").offsetWidth,o=t.querySelector(".right"),o.style.transform="translateX("+e+"px)",o.classList.remove("right"),o.classList.add("middle"))):t.querySelector(".right")&&(t.querySelector(".right").style.transform="translateX(0px)")),t.querySelector(".middle")||t.querySelector(".right")&&(e=t.querySelector(".left").offsetWidth,o=t.querySelector(".right"),o.style.transform="translateX("+e+"px)",o.classList.remove("right"),o.classList.add("middle"))})},getNextPhoto:function(){return PhotoTiles.config.photoListIndex>=PhotoTiles.config.photoList.length&&(PhotoTiles.config.photoListIndex=0),PhotoTiles.config.photoList[PhotoTiles.config.photoListIndex++]},toggleExecution:function(){PhotoTiles.config.shouldPlay=!PhotoTiles.config.shouldPlay,PhotoTiles.config.shouldPlay?PhotoTiles.play():PhotoTiles.pause()},pause:function(){clearInterval(PhotoTiles.config.timerId)},play:function(){PhotoTiles.config.shouldPlay=!0,PhotoTiles.loadTimer()},tileInfo:{getLgWidth:function(){return document.querySelector(".photo-lg")?document.querySelector(".photo-lg").offsetWidth:0},getSmWidth:function(){return document.querySelector(".photo-sm")?document.querySelector(".photo-sm").offsetWidth:0}},loadKeyboardEvents:function(){document.onkeydown=function(e){switch(e.keyCode){case 32:PhotoTiles.toggleExecution()}}},reset:function(){if(!PhotoTiles.config.initialized)return void console.info("PhotoTiles cannot be reset as it has not been initialized yet.");clearInterval(PhotoTiles.config.timerId);var e=document.querySelector(PhotoTiles.config.container);Array.prototype.forEach.call(document.querySelectorAll(".photo"),function(e){PhotoTiles.tagRandomPhotoForRemoval()}),setTimeout(function(){Array.prototype.forEach.call(e.children,function(e){e.parentNode.removeChild(e)}),PhotoTiles.config={initialized:!1,demoMode:!1,container:"",shouldPlay:!0,transition:0,timerId:0,photoListIndex:0,photoList:[]}},1e3)}};
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInBob3RvLXRpbGVzLmpzIl0sIm5hbWVzIjpbIlBob3RvVGlsZXMiLCJjb25maWciLCJpbml0aWFsaXplZCIsImRlbW9Nb2RlIiwiY29udGFpbmVyIiwic2hvdWxkUGxheSIsInRyYW5zaXRpb24iLCJ0aW1lcklkIiwicGhvdG9MaXN0SW5kZXgiLCJwaG90b0xpc3QiLCJpbml0aWFsaXplIiwiY29uc29sZSIsImluZm8iLCJzZWxlY3RvciIsInZhbGlkYXRlQ29uZmlncyIsImJ1aWxkVGlsZXMiLCJsb2FkVGlsZXMiLCJsb2FkRXZlbnRzIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yIiwibGVuZ3RoIiwidGlsZXMiLCJjcmVhdGVFbGVtZW50IiwiY2xhc3NOYW1lIiwicm93VG9wIiwicm93Qm90dG9tIiwiYXBwZW5kQ2hpbGQiLCJBcnJheSIsInByb3RvdHlwZSIsImZvckVhY2giLCJjYWxsIiwicXVlcnlTZWxlY3RvckFsbCIsInRpbGUiLCJuZXdQaG90byIsIm9mZnNldCIsIm5ld1Bob3RvU21Ub3AiLCJuZXdQaG90b1NtQm90dG9tIiwic3R5bGUiLCJnZXROZXh0UGhvdG8iLCJ0aWxlSW5mbyIsImdldExnV2lkdGgiLCJjaGlsZHJlbiIsInNtYWxsVGlsZSIsImdldFNtV2lkdGgiLCJzZXRUaW1lb3V0IiwiY2xhc3NMaXN0IiwiYWRkIiwibG9hZFRpbWVyIiwid2luZG93IiwiYWRkRXZlbnRMaXN0ZW5lciIsImNvbnRhaW5zIiwibG9hZEtleWJvYXJkRXZlbnRzIiwic2V0SW50ZXJ2YWwiLCJzaGlmdFBob3RvcyIsInRhZ1JhbmRvbVBob3RvRm9yUmVtb3ZhbCIsInBob3RvcyIsImNsZWFySW50ZXJ2YWwiLCJwaG90byIsIk1hdGgiLCJmbG9vciIsInJhbmRvbSIsImluZGV4T2YiLCJwYXJlbnRFbGVtZW50IiwiaW1nVXJsIiwiaW1nIiwiSW1hZ2UiLCJvbmxvYWQiLCJhZGp1c3RUaWxlcyIsImFkZFBob3RvIiwic3JjIiwic3RhcnRQb3NpdGlvbiIsImlubmVyV2lkdGgiLCJwYXJlbnROb2RlIiwicmVtb3ZlQ2hpbGQiLCJyZW1vdmUiLCJvZmZzZXRXaWR0aCIsInRvZ2dsZUV4ZWN1dGlvbiIsInBsYXkiLCJwYXVzZSIsIm9ua2V5ZG93biIsImV2ZW50Iiwia2V5Q29kZSIsInJlc2V0IiwiZWxlbWVudCJdLCJtYXBwaW5ncyI6IkFBQUEsR0FBSUEsYUFDQUMsUUFDSUMsYUFBYSxFQUNiQyxVQUFVLEVBQ1ZDLFVBQVcseUJBQ1hDLFlBQVksRUFDWkMsV0FBWSxJQUNaQyxRQUFTLEVBQ1RDLGVBQWdCLEVBQ2hCQyxjQUVKQyxXQUFZLFNBQVVULEdBQ2xCLE1BQUlELFlBQVdDLE9BQU9DLGdCQUNsQlMsU0FBUUMsS0FBSyxtQ0FHWlgsR0FJTEQsV0FBV0MsT0FBT0csVUFBWUgsRUFBT1ksVUFBWSx5QkFDakRiLFdBQVdDLE9BQU9JLFdBQWFKLEVBQU9JLGFBQWMsRUFDcERMLFdBQVdDLE9BQU9LLFdBQWFMLEVBQU9LLFlBQWMsSUFDcEROLFdBQVdDLE9BQU9RLFVBQVlSLEVBQU9RLGNBQ3JDVCxXQUFXQyxPQUFPRSxTQUFXRixFQUFPRSxXQUFZLEVBQzNDSCxXQUFXYyxnQkFBZ0JiLElBSTVCQSxFQUFPRSxXQUNQSCxXQUFXQyxPQUFPUSxXQUNkLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLHVDQUNBLDBDQUdSVCxXQUFXZSxhQUNYZixXQUFXZ0IsWUFDWGhCLFdBQVdpQixrQkFDWGpCLFdBQVdDLE9BQU9DLGFBQWMsUUFwQjVCUyxTQUFRQyxLQUFLLG9DQVRiRCxTQUFRQyxLQUFLLHlIQStCckJFLGdCQUFpQixTQUFVYixHQUN2QixNQUFLaUIsVUFBU0MsY0FBY25CLFdBQVdDLE9BQU9HLGFBSUgsSUFBdkNKLFdBQVdDLE9BQU9RLFVBQVVXLFNBQWlCcEIsV0FBV0MsT0FBT0UsWUFDL0RRLFFBQVFDLEtBQUssOEdBQ04sSUFMUEQsUUFBUUMsS0FBSyxnRkFBa0ZaLFdBQVdDLE9BQU9HLFVBQVksT0FDdEgsSUFR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QUFZYyxTQUFTQyxjQUFjbkIsV0FBV0MsT0FBT0csVUFDekR1QixPQUFNQyxVQUFVQyxRQUFRQyxLQUFLWixTQUFTYSxpQkFBaUIsVUFBVyxTQUFVMEIsR0FDeEV6RCxXQUFXc0QsNkJBRWZWLFdBQVcsV0FDUGpCLE1BQU1DLFVBQVVDLFFBQVFDLEtBQUsxQixFQUFVcUMsU0FBVSxTQUFVMEMsR0FDdkRBLEVBQVFYLFdBQVdDLFlBQVlVLEtBRW5DbkYsV0FBV0MsUUFDUEMsYUFBYSxFQUNiQyxVQUFVLEVBQ1ZDLFVBQVcsR0FDWEMsWUFBWSxFQUNaQyxXQUFZLEVBQ1pDLFFBQVMsRUFDVEMsZUFBZ0IsRUFDaEJDLGVBRUwiLCJmaWxlIjoicGhvdG8tdGlsZXMubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFBob3RvVGlsZXMgPSB7XG4gICAgY29uZmlnOiB7XG4gICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgZGVtb01vZGU6IGZhbHNlLFxuICAgICAgICBjb250YWluZXI6IFwiLnBob3RvLXRpbGVzLWNvbnRhaW5lclwiLFxuICAgICAgICBzaG91bGRQbGF5OiB0cnVlLFxuICAgICAgICB0cmFuc2l0aW9uOiAyMDAwLFxuICAgICAgICB0aW1lcklkOiAwLFxuICAgICAgICBwaG90b0xpc3RJbmRleDogMCxcbiAgICAgICAgcGhvdG9MaXN0OiBbXSxcbiAgICB9LFxuICAgIGluaXRpYWxpemU6IGZ1bmN0aW9uIChjb25maWcpIHtcbiAgICAgICAgaWYgKFBob3RvVGlsZXMuY29uZmlnLmluaXRpYWxpemVkKSB7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oXCJQaG90b1RpbGVzIGFscmVhZHkgaW5pdGlhbGl6ZWQuXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmICghY29uZmlnKSB7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oXCJObyBjb25maWd1cmF0aW9uIG9iamVjdCB3YXMgcGFzc2VkLCBjaGVja291dCBodHRwczovL2dpdGh1Yi5jb20vYXJ2YXJnaGVzZS9waG90by10aWxlcyNjdXN0b21pemF0aW9uIGZvciBhbiBleGFtcGxlLlwiKTtcbiAgICAgICAgICAgIHJldHVybjtcbiAgICAgICAgfVxuICAgICAgICBQaG90b1RpbGVzLmNvbmZpZy5jb250YWluZXIgPSBjb25maWcuc2VsZWN0b3IgfHwgXCIucGhvdG8tdGlsZXMtY29udGFpbmVyXCI7XG4gICAgICAgIFBob3RvVGlsZXMuY29uZmlnLnNob3VsZFBsYXkgPSBjb25maWcuc2hvdWxkUGxheSB8fCB0cnVlO1xuICAgICAgICBQaG90b1RpbGVzLmNvbmZpZy50cmFuc2l0aW9uID0gY29uZmlnLnRyYW5zaXRpb24gfHwgMjAwMDtcbiAgICAgICAgUGhvdG9UaWxlcy5jb25maWcucGhvdG9MaXN0ID0gY29uZmlnLnBob3RvTGlzdCB8fCBbXTtcbiAgICAgICAgUGhvdG9UaWxlcy5jb25maWcuZGVtb01vZGUgPSBjb25maWcuZGVtb01vZGUgfHwgZmFsc2U7XG4gICAgICAgIGlmICghUGhvdG9UaWxlcy52YWxpZGF0ZUNvbmZpZ3MoY29uZmlnKSkge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiUGhvdG9UaWxlcyBub3QgaW5pdGlhbGl6ZWQuXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGlmIChjb25maWcuZGVtb01vZGUpIHtcbiAgICAgICAgICAgIFBob3RvVGlsZXMuY29uZmlnLnBob3RvTGlzdCA9IFtcbiAgICAgICAgICAgICAgICBcImFzc2V0cy9pbWFnZXMvZGVtby9kZW1vLWltYWdlLTEuanBlZ1wiLFxuICAgICAgICAgICAgICAgIFwiYXNzZXRzL2ltYWdlcy9kZW1vL2RlbW8taW1hZ2UtMi5qcGVnXCIsXG4gICAgICAgICAgICAgICAgXCJhc3NldHMvaW1hZ2VzL2RlbW8vZGVtby1pbWFnZS0zLmpwZWdcIixcbiAgICAgICAgICAgICAgICBcImFzc2V0cy9pbWFnZXMvZGVtby9kZW1vLWltYWdlLTQuanBlZ1wiLFxuICAgICAgICAgICAgICAgIFwiYXNzZXRzL2ltYWdlcy9kZW1vL2RlbW8taW1hZ2UtNS5qcGVnXCIsXG4gICAgICAgICAgICAgICAgXCJhc3NldHMvaW1hZ2VzL2RlbW8vZGVtby1pbWFnZS02LmpwZWdcIixcbiAgICAgICAgICAgICAgICBcImFzc2V0cy9pbWFnZXMvZGVtby9kZW1vLWltYWdlLTcuanBlZ1wiLFxuICAgICAgICAgICAgICAgIFwiYXNzZXRzL2ltYWdlcy9kZW1vL2RlbW8taW1hZ2UtOC5qcGVnXCIsXG4gICAgICAgICAgICAgICAgXCJhc3NldHMvaW1hZ2VzL2RlbW8vZGVtby1pbWFnZS05LmpwZWdcIixcbiAgICAgICAgICAgICAgICBcImFzc2V0cy9pbWFnZXMvZGVtby9kZW1vLWltYWdlLTEwLmpwZWdcIlxuICAgICAgICAgICAgXTtcbiAgICAgICAgfVxuICAgICAgICBQaG90b1RpbGVzLmJ1aWxkVGlsZXMoKTtcbiAgICAgICAgUGhvdG9UaWxlcy5sb2FkVGlsZXMoKTtcbiAgICAgICAgUGhvdG9UaWxlcy5sb2FkRXZlbnRzKCk7XG4gICAgICAgIFBob3RvVGlsZXMuY29uZmlnLmluaXRpYWxpemVkID0gdHJ1ZTtcbiAgICB9LFxuICAgIHZhbGlkYXRlQ29uZmlnczogZnVuY3Rpb24gKGNvbmZpZykge1xuICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoUGhvdG9UaWxlcy5jb25maWcuY29udGFpbmVyKSkge1xuICAgICAgICAgICAgY29uc29sZS5pbmZvKFwiTm8gY29udGFpbmVyIHNwZWNpZmllZCBvciBjb250YWluZXIgZG9lc24ndCBleGlzdCBvbiB0aGUgcGFnZSB3aXRoIHNlbGVjdG9yICdcIiArIFBob3RvVGlsZXMuY29uZmlnLmNvbnRhaW5lciArIFwiJy5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKFBob3RvVGlsZXMuY29uZmlnLnBob3RvTGlzdC5sZW5ndGggPT09IDAgJiYgIVBob3RvVGlsZXMuY29uZmlnLmRlbW9Nb2RlKSB7XG4gICAgICAgICAgICBjb25zb2xlLmluZm8oXCJObyBwaG90b3Mgc3BlY2lmaWVkLCBwbGVhc2UgaW5pdGlhbGl6ZSBQaG90b1RpbGVzIHdpdGggdGhlIGF0dHJpYnV0ZSAncGhvdG9MaXN0JyBzZXQgdG8gYSBsaXN0IG9mIHBob3Rvcy5cIik7XG4gICAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSxcbiAgICBidWlsZFRpbGVzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFBob3RvVGlsZXMuY29uZmlnLmNvbnRhaW5lcik7XG4gICAgICAgIHZhciB0aWxlcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHRpbGVzLmNsYXNzTmFtZSA9IFwicGhvdG8tdGlsZXNcIjtcbiAgICAgICAgdmFyIHJvd1RvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgIHJvd1RvcC5jbGFzc05hbWUgPSBcInBob3RvLXRpbGVzLXJvd1wiO1xuICAgICAgICB2YXIgcm93Qm90dG9tID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImRpdlwiKTtcbiAgICAgICAgcm93Qm90dG9tLmNsYXNzTmFtZSA9IFwicGhvdG8tdGlsZXMtcm93XCI7XG4gICAgICAgIHRpbGVzLmFwcGVuZENoaWxkKHJvd1RvcCk7XG4gICAgICAgIHRpbGVzLmFwcGVuZENoaWxkKHJvd0JvdHRvbSk7XG4gICAgICAgIGNvbnRhaW5lci5hcHBlbmRDaGlsZCh0aWxlcyk7XG4gICAgfSxcbiAgICBsb2FkVGlsZXM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBob3RvLXRpbGVzLXJvd1wiKSwgZnVuY3Rpb24gKHRpbGUpIHtcbiAgICAgICAgICAgIHZhciBuZXdQaG90bywgbmV3UGhvdG9TbSwgb2Zmc2V0LCBuZXdQaG90b1NtVG9wLCBuZXdQaG90b1NtQm90dG9tO1xuICAgICAgICAgICAgbmV3UGhvdG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbmV3UGhvdG8uY2xhc3NOYW1lID0gXCJwaG90byBsZWZ0IHBob3RvLWxnXCI7XG4gICAgICAgICAgICBuZXdQaG90by5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWCgwcHgpXCI7XG4gICAgICAgICAgICBuZXdQaG90by5zdHlsZVtcImJhY2tncm91bmQtaW1hZ2VcIl0gPSBcInVybChcIiArIFBob3RvVGlsZXMuZ2V0TmV4dFBob3RvKCkgKyBcIilcIjtcbiAgICAgICAgICAgIHRpbGUuYXBwZW5kQ2hpbGQobmV3UGhvdG8pO1xuICAgICAgICAgICAgbmV3UGhvdG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbmV3UGhvdG8uY2xhc3NOYW1lID0gXCJwaG90byBtaWRkbGUgcGhvdG8tc21cIjtcbiAgICAgICAgICAgIG5ld1Bob3RvU21Ub3AgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbmV3UGhvdG9TbVRvcC5jbGFzc05hbWUgPSBcInBob3RvLXNtLWR1YWxcIjtcbiAgICAgICAgICAgIG5ld1Bob3RvU21Cb3R0b20gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbmV3UGhvdG9TbUJvdHRvbS5jbGFzc05hbWUgPSBcInBob3RvLXNtLWR1YWxcIjtcbiAgICAgICAgICAgIG5ld1Bob3RvLmFwcGVuZENoaWxkKG5ld1Bob3RvU21Ub3ApO1xuICAgICAgICAgICAgbmV3UGhvdG8uYXBwZW5kQ2hpbGQobmV3UGhvdG9TbUJvdHRvbSk7XG4gICAgICAgICAgICB0aWxlLmFwcGVuZENoaWxkKG5ld1Bob3RvKTtcbiAgICAgICAgICAgIG9mZnNldCA9IFBob3RvVGlsZXMudGlsZUluZm8uZ2V0TGdXaWR0aCgpO1xuICAgICAgICAgICAgbmV3UGhvdG8uc3R5bGVbXCJ0cmFuc2Zvcm1cIl0gPSBcInRyYW5zbGF0ZVgoXCIgKyBvZmZzZXQgKyBcInB4KVwiO1xuICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChuZXdQaG90by5jaGlsZHJlbiwgZnVuY3Rpb24gKHNtYWxsVGlsZSkge1xuICAgICAgICAgICAgICAgIHNtYWxsVGlsZS5zdHlsZVtcImJhY2tncm91bmQtaW1hZ2VcIl0gPSBcInVybChcIiArIFBob3RvVGlsZXMuZ2V0TmV4dFBob3RvKCkgKyBcIilcIjtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgbmV3UGhvdG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgbmV3UGhvdG8uY2xhc3NOYW1lID0gXCJwaG90byByaWdodCBwaG90by1sZ1wiO1xuICAgICAgICAgICAgb2Zmc2V0ID0gUGhvdG9UaWxlcy50aWxlSW5mby5nZXRMZ1dpZHRoKCkgKyBQaG90b1RpbGVzLnRpbGVJbmZvLmdldFNtV2lkdGgoKTtcbiAgICAgICAgICAgIG5ld1Bob3RvLnN0eWxlW1widHJhbnNmb3JtXCJdID0gXCJ0cmFuc2xhdGVYKFwiICsgb2Zmc2V0ICsgXCJweClcIjtcbiAgICAgICAgICAgIG5ld1Bob3RvLnN0eWxlW1wiYmFja2dyb3VuZC1pbWFnZVwiXSA9IFwidXJsKFwiICsgUGhvdG9UaWxlcy5nZXROZXh0UGhvdG8oKSArIFwiKVwiO1xuICAgICAgICAgICAgdGlsZS5hcHBlbmRDaGlsZChuZXdQaG90byk7XG4gICAgICAgIH0pO1xuICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5waG90b1wiKSwgZnVuY3Rpb24gKHRpbGUpIHtcbiAgICAgICAgICAgICAgICB0aWxlLmNsYXNzTGlzdC5hZGQoXCJsb2FkZWRcIik7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSwgMTAwMCk7XG4gICAgfSxcbiAgICBsb2FkRXZlbnRzOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChQaG90b1RpbGVzLmNvbmZpZy5zaG91bGRQbGF5KSB7XG4gICAgICAgICAgICBQaG90b1RpbGVzLmxvYWRUaW1lcigpO1xuICAgICAgICB9XG4gICAgICAgIHZhciBvZmZzZXQ7XG4gICAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKFwicmVzaXplXCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5waG90by10aWxlcy1yb3dcIiksIGZ1bmN0aW9uICh0aWxlKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRpbGUucXVlcnlTZWxlY3RvcihcIi5sZWZ0XCIpICYmIHRpbGUucXVlcnlTZWxlY3RvcihcIi5sZWZ0XCIpLmNsYXNzTGlzdC5jb250YWlucyhcInBob3RvLXNtXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IFBob3RvVGlsZXMudGlsZUluZm8uZ2V0U21XaWR0aCgpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gUGhvdG9UaWxlcy50aWxlSW5mby5nZXRMZ1dpZHRoKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbGUucXVlcnlTZWxlY3RvcihcIi5taWRkbGVcIikuc3R5bGVbXCJ0cmFuc2Zvcm1cIl0gPSBcInRyYW5zbGF0ZVgoXCIgKyBvZmZzZXQgKyBcInB4KVwiO1xuICAgICAgICAgICAgICAgIGlmICh0aWxlLnF1ZXJ5U2VsZWN0b3IoXCIucmlnaHRcIikgJiYgdGlsZS5xdWVyeVNlbGVjdG9yKFwiLnJpZ2h0XCIpLmNsYXNzTGlzdC5jb250YWlucyhcInBob3RvLXNtXCIpKSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IFBob3RvVGlsZXMudGlsZUluZm8uZ2V0TGdXaWR0aCgpICogMjtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgIG9mZnNldCA9IFBob3RvVGlsZXMudGlsZUluZm8uZ2V0U21XaWR0aCgpICsgUGhvdG9UaWxlcy50aWxlSW5mby5nZXRMZ1dpZHRoKCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIHRpbGUucXVlcnlTZWxlY3RvcihcIi5yaWdodFwiKS5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWChcIiArIG9mZnNldCArIFwicHgpXCI7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgICAgIFBob3RvVGlsZXMubG9hZEtleWJvYXJkRXZlbnRzKCk7XG4gICAgfSxcbiAgICBsb2FkVGltZXI6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgUGhvdG9UaWxlcy5jb25maWcudGltZXJJZCA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgIFBob3RvVGlsZXMuc2hpZnRQaG90b3MoKTtcbiAgICAgICAgfSwgUGhvdG9UaWxlcy5jb25maWcudHJhbnNpdGlvbik7XG4gICAgfSxcbiAgICB0YWdSYW5kb21QaG90b0ZvclJlbW92YWw6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgdmFyIHBob3RvcyA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGhvdG86bm90KC5yZW1vdmUpXCIpO1xuICAgICAgICBpZiAocGhvdG9zLmxlbmd0aCA8IDIpIHtcbiAgICAgICAgICAgIGNsZWFySW50ZXJ2YWwoUGhvdG9UaWxlcy5jb25maWcudGltZXJJZCk7XG4gICAgICAgIH1cbiAgICAgICAgdmFyIHBob3RvID0gcGhvdG9zW01hdGguZmxvb3IoTWF0aC5yYW5kb20oKSAqIHBob3Rvcy5sZW5ndGgpXTtcbiAgICAgICAgaWYgKHBob3RvLmNsYXNzTGlzdC5jb250YWlucyhcImxlZnRcIikpIHtcbiAgICAgICAgICAgIHBob3RvLnN0eWxlW1widHJhbnNmb3JtXCJdICs9IFwidHJhbnNsYXRlWCgtMTAwJSlcIjtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIGlmIChwaG90by5jbGFzc0xpc3QuY29udGFpbnMoXCJyaWdodFwiKSkge1xuICAgICAgICAgICAgcGhvdG8uc3R5bGVbXCJ0cmFuc2Zvcm1cIl0gKz0gXCJ0cmFuc2xhdGVYKDEwMCUpXCI7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHBob3RvLmNsYXNzTGlzdC5jb250YWlucyhcIm1pZGRsZVwiKSkge1xuICAgICAgICAgICAgaWYgKEFycmF5LnByb3RvdHlwZS5pbmRleE9mLmNhbGwocGhvdG8ucGFyZW50RWxlbWVudC5wYXJlbnRFbGVtZW50LmNoaWxkcmVuLCBwaG90by5wYXJlbnRFbGVtZW50KSA9PT0gMCkge1xuICAgICAgICAgICAgICAgIHBob3RvLnN0eWxlW1widHJhbnNmb3JtXCJdICs9IFwidHJhbnNsYXRlWSgtMTAwJSlcIjtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIHBob3RvLnN0eWxlW1widHJhbnNmb3JtXCJdICs9IFwidHJhbnNsYXRlWSgxMDAlKVwiO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIHBob3RvLmNsYXNzTGlzdC5hZGQoXCJyZW1vdmVcIik7XG4gICAgfSxcbiAgICBzaGlmdFBob3RvczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgaW1nVXJsID0gUGhvdG9UaWxlcy5nZXROZXh0UGhvdG8oKTtcbiAgICAgICAgdmFyIGltZyA9IG5ldyBJbWFnZSgpO1xuICAgICAgICBpbWcub25sb2FkID0gZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgUGhvdG9UaWxlcy50YWdSYW5kb21QaG90b0ZvclJlbW92YWwoKTtcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24gKCkge1xuICAgICAgICAgICAgICAgIFBob3RvVGlsZXMuYWRqdXN0VGlsZXMoKTtcbiAgICAgICAgICAgICAgICBQaG90b1RpbGVzLmFkZFBob3RvKGltZ1VybCk7XG4gICAgICAgICAgICB9LCAzMDApO1xuICAgICAgICB9O1xuICAgICAgICBpbWcuc3JjID0gaW1nVXJsO1xuICAgIH0sXG4gICAgYWRkUGhvdG86IGZ1bmN0aW9uIChpbWdVcmwpIHtcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnBob3RvLXRpbGVzLXJvd1wiKSwgZnVuY3Rpb24gKHRpbGUpIHtcbiAgICAgICAgICAgIGlmICh0aWxlLnF1ZXJ5U2VsZWN0b3JBbGwoXCIucGhvdG9cIikubGVuZ3RoID09PSAzKSB7XG4gICAgICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgdmFyIG5ld1Bob3RvLCBvZmZzZXQ7XG4gICAgICAgICAgICBpZiAodGlsZS5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLXNtXCIpKSB7XG4gICAgICAgICAgICAgICAgbmV3UGhvdG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgIG5ld1Bob3RvLmNsYXNzTmFtZSA9IFwicGhvdG8gcmlnaHQgcGhvdG8tbGdcIjtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBQaG90b1RpbGVzLnRpbGVJbmZvLmdldFNtV2lkdGgoKSArIFBob3RvVGlsZXMudGlsZUluZm8uZ2V0TGdXaWR0aCgpO1xuICAgICAgICAgICAgfVxuICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgbmV3UGhvdG8gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KFwiZGl2XCIpO1xuICAgICAgICAgICAgICAgIG5ld1Bob3RvLmNsYXNzTmFtZSA9IFwicGhvdG8gcmlnaHQgcGhvdG8tc21cIjtcbiAgICAgICAgICAgICAgICB2YXIgbmV3UGhvdG9TbVRvcCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICAgICAgbmV3UGhvdG9TbVRvcC5jbGFzc05hbWUgPSBcInBob3RvLXNtLWR1YWxcIjtcbiAgICAgICAgICAgICAgICB2YXIgbmV3UGhvdG9TbUJvdHRvbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoXCJkaXZcIik7XG4gICAgICAgICAgICAgICAgbmV3UGhvdG9TbUJvdHRvbS5jbGFzc05hbWUgPSBcInBob3RvLXNtLWR1YWxcIjtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5hcHBlbmRDaGlsZChuZXdQaG90b1NtVG9wKTtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5hcHBlbmRDaGlsZChuZXdQaG90b1NtQm90dG9tKTtcbiAgICAgICAgICAgICAgICBvZmZzZXQgPSBQaG90b1RpbGVzLnRpbGVJbmZvLmdldExnV2lkdGgoKSAqIDI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICB0aWxlLmFwcGVuZENoaWxkKG5ld1Bob3RvKTtcbiAgICAgICAgICAgIHZhciBzdGFydFBvc2l0aW9uID0gd2luZG93LmlubmVyV2lkdGg7XG4gICAgICAgICAgICBpZiAobmV3UGhvdG8uY2xhc3NMaXN0LmNvbnRhaW5zKFwicGhvdG8tc21cIikpIHtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWChcIiArIHN0YXJ0UG9zaXRpb24gKyBcInB4KVwiO1xuICAgICAgICAgICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwodGlsZS5xdWVyeVNlbGVjdG9yQWxsKFwiLnBob3RvLXNtLWR1YWxcIiksIGZ1bmN0aW9uICh0aWxlKSB7XG4gICAgICAgICAgICAgICAgICAgIGltZ1VybCA9IFBob3RvVGlsZXMuZ2V0TmV4dFBob3RvKCk7XG4gICAgICAgICAgICAgICAgICAgIHRpbGUuc3R5bGVbXCJiYWNrZ3JvdW5kLWltYWdlXCJdID0gXCJ1cmwoXCIgKyBpbWdVcmwgKyBcIilcIjtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgIG5ld1Bob3RvLnN0eWxlW1widHJhbnNpdGlvblwiXSA9IFwiMHNcIjtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWChcIiArIHN0YXJ0UG9zaXRpb24gKyBcInB4KVwiO1xuICAgICAgICAgICAgICAgIG5ld1Bob3RvLnN0eWxlW1wiYmFja2dyb3VuZC1pbWFnZVwiXSA9IFwidXJsKFwiICsgaW1nVXJsICsgXCIpXCI7XG4gICAgICAgICAgICB9XG4gICAgICAgICAgICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5zdHlsZVtcInRyYW5zaXRpb25cIl0gPSBcIi41cyBlYXNlLWluLW91dFwiO1xuICAgICAgICAgICAgICAgIG5ld1Bob3RvLnN0eWxlW1widHJhbnNmb3JtXCJdID0gXCJ0cmFuc2xhdGVYKFwiICsgb2Zmc2V0ICsgXCJweClcIjtcbiAgICAgICAgICAgICAgICBuZXdQaG90by5jbGFzc0xpc3QuYWRkKFwibG9hZGVkXCIpO1xuICAgICAgICAgICAgfSwgMjAwKTtcbiAgICAgICAgfSk7XG4gICAgfSxcbiAgICBhZGp1c3RUaWxlczogZnVuY3Rpb24gKCkge1xuICAgICAgICB2YXIgb2Zmc2V0LCBwaG90bztcbiAgICAgICAgQXJyYXkucHJvdG90eXBlLmZvckVhY2guY2FsbChkb2N1bWVudC5xdWVyeVNlbGVjdG9yQWxsKFwiLnJlbW92ZVwiKSwgZnVuY3Rpb24gKHRpbGUpIHtcbiAgICAgICAgICAgIHRpbGUucGFyZW50Tm9kZS5yZW1vdmVDaGlsZCh0aWxlKTtcbiAgICAgICAgfSk7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5waG90by10aWxlcy1yb3dcIiksIGZ1bmN0aW9uICh0aWxlKSB7XG4gICAgICAgICAgICBpZiAoIXRpbGUucXVlcnlTZWxlY3RvcihcIi5sZWZ0XCIpKSB7XG4gICAgICAgICAgICAgICAgaWYgKHRpbGUucXVlcnlTZWxlY3RvcihcIi5taWRkbGVcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgcGhvdG8gPSB0aWxlLnF1ZXJ5U2VsZWN0b3IoXCIubWlkZGxlXCIpO1xuICAgICAgICAgICAgICAgICAgICBwaG90by5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWCgwcHgpXCI7XG4gICAgICAgICAgICAgICAgICAgIHBob3RvLmNsYXNzTGlzdC5yZW1vdmUoXCJtaWRkbGVcIik7XG4gICAgICAgICAgICAgICAgICAgIHBob3RvLmNsYXNzTGlzdC5hZGQoXCJsZWZ0XCIpO1xuICAgICAgICAgICAgICAgICAgICBpZiAodGlsZS5xdWVyeVNlbGVjdG9yKFwiLnJpZ2h0XCIpKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBvZmZzZXQgPSB0aWxlLnF1ZXJ5U2VsZWN0b3IoXCIubGVmdFwiKS5vZmZzZXRXaWR0aDtcbiAgICAgICAgICAgICAgICAgICAgICAgIHBob3RvID0gdGlsZS5xdWVyeVNlbGVjdG9yKFwiLnJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGhvdG8uc3R5bGVbXCJ0cmFuc2Zvcm1cIl0gPSBcInRyYW5zbGF0ZVgoXCIgKyBvZmZzZXQgKyBcInB4KVwiO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGhvdG8uY2xhc3NMaXN0LnJlbW92ZShcInJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICAgICAgcGhvdG8uY2xhc3NMaXN0LmFkZChcIm1pZGRsZVwiKTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgICAgICAgICAgaWYgKHRpbGUucXVlcnlTZWxlY3RvcihcIi5yaWdodFwiKSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgdGlsZS5xdWVyeVNlbGVjdG9yKFwiLnJpZ2h0XCIpLnN0eWxlW1widHJhbnNmb3JtXCJdID0gXCJ0cmFuc2xhdGVYKDBweClcIjtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGlmICghdGlsZS5xdWVyeVNlbGVjdG9yKFwiLm1pZGRsZVwiKSkge1xuICAgICAgICAgICAgICAgIGlmICh0aWxlLnF1ZXJ5U2VsZWN0b3IoXCIucmlnaHRcIikpIHtcbiAgICAgICAgICAgICAgICAgICAgb2Zmc2V0ID0gdGlsZS5xdWVyeVNlbGVjdG9yKFwiLmxlZnRcIikub2Zmc2V0V2lkdGg7XG4gICAgICAgICAgICAgICAgICAgIHBob3RvID0gdGlsZS5xdWVyeVNlbGVjdG9yKFwiLnJpZ2h0XCIpO1xuICAgICAgICAgICAgICAgICAgICBwaG90by5zdHlsZVtcInRyYW5zZm9ybVwiXSA9IFwidHJhbnNsYXRlWChcIiArIG9mZnNldCArIFwicHgpXCI7XG4gICAgICAgICAgICAgICAgICAgIHBob3RvLmNsYXNzTGlzdC5yZW1vdmUoXCJyaWdodFwiKTtcbiAgICAgICAgICAgICAgICAgICAgcGhvdG8uY2xhc3NMaXN0LmFkZChcIm1pZGRsZVwiKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgIH0sXG4gICAgZ2V0TmV4dFBob3RvOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmIChQaG90b1RpbGVzLmNvbmZpZy5waG90b0xpc3RJbmRleCA+PSBQaG90b1RpbGVzLmNvbmZpZy5waG90b0xpc3QubGVuZ3RoKSB7XG4gICAgICAgICAgICBQaG90b1RpbGVzLmNvbmZpZy5waG90b0xpc3RJbmRleCA9IDA7XG4gICAgICAgIH1cbiAgICAgICAgcmV0dXJuIFBob3RvVGlsZXMuY29uZmlnLnBob3RvTGlzdFtQaG90b1RpbGVzLmNvbmZpZy5waG90b0xpc3RJbmRleCsrXTtcbiAgICB9LFxuICAgIHRvZ2dsZUV4ZWN1dGlvbjogZnVuY3Rpb24gKCkge1xuICAgICAgICBQaG90b1RpbGVzLmNvbmZpZy5zaG91bGRQbGF5ID0gIVBob3RvVGlsZXMuY29uZmlnLnNob3VsZFBsYXk7XG4gICAgICAgIGlmIChQaG90b1RpbGVzLmNvbmZpZy5zaG91bGRQbGF5KSB7XG4gICAgICAgICAgICBQaG90b1RpbGVzLnBsYXkoKTtcbiAgICAgICAgfVxuICAgICAgICBlbHNlIHtcbiAgICAgICAgICAgIFBob3RvVGlsZXMucGF1c2UoKTtcbiAgICAgICAgfVxuICAgIH0sXG4gICAgcGF1c2U6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgY2xlYXJJbnRlcnZhbChQaG90b1RpbGVzLmNvbmZpZy50aW1lcklkKTtcbiAgICB9LFxuICAgIHBsYXk6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgUGhvdG9UaWxlcy5jb25maWcuc2hvdWxkUGxheSA9IHRydWU7XG4gICAgICAgIFBob3RvVGlsZXMubG9hZFRpbWVyKCk7XG4gICAgfSxcbiAgICB0aWxlSW5mbzoge1xuICAgICAgICBnZXRMZ1dpZHRoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tbGdcIikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLWxnXCIpLm9mZnNldFdpZHRoO1xuICAgICAgICB9LFxuICAgICAgICBnZXRTbVdpZHRoOiBmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBpZiAoIWRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucGhvdG8tc21cIikpIHtcbiAgICAgICAgICAgICAgICByZXR1cm4gMDtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIHJldHVybiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnBob3RvLXNtXCIpLm9mZnNldFdpZHRoO1xuICAgICAgICB9XG4gICAgfSxcbiAgICBsb2FkS2V5Ym9hcmRFdmVudHM6IGZ1bmN0aW9uICgpIHtcbiAgICAgICAgZG9jdW1lbnQub25rZXlkb3duID0gZnVuY3Rpb24gKGV2ZW50KSB7XG4gICAgICAgICAgICBzd2l0Y2ggKGV2ZW50LmtleUNvZGUpIHtcbiAgICAgICAgICAgICAgICBjYXNlIDMyOlxuICAgICAgICAgICAgICAgICAgICBQaG90b1RpbGVzLnRvZ2dsZUV4ZWN1dGlvbigpO1xuICAgICAgICAgICAgICAgICAgICBicmVhaztcbiAgICAgICAgICAgIH1cbiAgICAgICAgfTtcbiAgICB9LFxuICAgIHJlc2V0OiBmdW5jdGlvbiAoKSB7XG4gICAgICAgIGlmICghUGhvdG9UaWxlcy5jb25maWcuaW5pdGlhbGl6ZWQpIHtcbiAgICAgICAgICAgIGNvbnNvbGUuaW5mbyhcIlBob3RvVGlsZXMgY2Fubm90IGJlIHJlc2V0IGFzIGl0IGhhcyBub3QgYmVlbiBpbml0aWFsaXplZCB5ZXQuXCIpO1xuICAgICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIGNsZWFySW50ZXJ2YWwoUGhvdG9UaWxlcy5jb25maWcudGltZXJJZCk7XG4gICAgICAgIHZhciBjb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFBob3RvVGlsZXMuY29uZmlnLmNvbnRhaW5lcik7XG4gICAgICAgIEFycmF5LnByb3RvdHlwZS5mb3JFYWNoLmNhbGwoZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5waG90b1wiKSwgZnVuY3Rpb24gKHBob3RvKSB7XG4gICAgICAgICAgICBQaG90b1RpbGVzLnRhZ1JhbmRvbVBob3RvRm9yUmVtb3ZhbCgpO1xuICAgICAgICB9KTtcbiAgICAgICAgc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICAgICAgICBBcnJheS5wcm90b3R5cGUuZm9yRWFjaC5jYWxsKGNvbnRhaW5lci5jaGlsZHJlbiwgZnVuY3Rpb24gKGVsZW1lbnQpIHtcbiAgICAgICAgICAgICAgICBlbGVtZW50LnBhcmVudE5vZGUucmVtb3ZlQ2hpbGQoZWxlbWVudCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIFBob3RvVGlsZXMuY29uZmlnID0ge1xuICAgICAgICAgICAgICAgIGluaXRpYWxpemVkOiBmYWxzZSxcbiAgICAgICAgICAgICAgICBkZW1vTW9kZTogZmFsc2UsXG4gICAgICAgICAgICAgICAgY29udGFpbmVyOiBcIlwiLFxuICAgICAgICAgICAgICAgIHNob3VsZFBsYXk6IHRydWUsXG4gICAgICAgICAgICAgICAgdHJhbnNpdGlvbjogMCxcbiAgICAgICAgICAgICAgICB0aW1lcklkOiAwLFxuICAgICAgICAgICAgICAgIHBob3RvTGlzdEluZGV4OiAwLFxuICAgICAgICAgICAgICAgIHBob3RvTGlzdDogW10sXG4gICAgICAgICAgICB9O1xuICAgICAgICB9LCAxMDAwKTtcbiAgICB9XG59O1xuIl19
